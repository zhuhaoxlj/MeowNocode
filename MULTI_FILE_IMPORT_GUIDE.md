# Memos 多文件导入功能说明

## 🎯 新增功能

现在支持同时导入 Memos 数据库的完整文件组合：
- `.db` - 主数据库文件
- `.db-wal` - WAL (Write-Ahead Log) 文件
- `.db-shm` - SHM (Shared Memory) 文件

## 🚀 使用方法

### 方法一：拖拽上传（推荐）
1. 打开设置 → 数据标签页
2. 同时选中三个文件：`memos_dev.db`、`memos_dev.db-wal`、`memos_dev.db-shm`
3. 拖拽到上传区域
4. 点击"开始导入"

### 方法二：文件选择器
1. 点击"选择文件"按钮
2. 按住 `Ctrl`（Windows）或 `Cmd`（Mac）多选三个文件
3. 确认选择
4. 点击"开始导入"

## ✅ 优势

### 🔄 数据完整性
- **完整事务支持**：包含所有未提交的事务
- **最新数据保证**：WAL文件中的最新写入不会丢失
- **一致性状态**：避免数据库处于中间状态

### 🎯 解决的问题
- ✅ 修复了之前缺失3条记录的问题
- ✅ 支持活跃数据库的完整备份
- ✅ 避免WAL文件处理的复杂性

## 📊 技术细节

### 后端处理流程
1. **文件重建**：在服务器端重建完整的数据库文件组合
2. **WAL合并**：自动处理WAL文件合并
3. **完整读取**：确保读取所有记录，包括最新的事务
4. **安全清理**：自动清理所有临时文件

### 兼容性
- ✅ 向下兼容：仍支持单独上传`.db`文件
- ✅ 智能检测：自动识别文件类型和数量
- ✅ 错误处理：完善的错误提示和诊断信息

## 🛠️ 故障排除

### 如果仍有数据缺失
1. 确保上传了完整的三文件组合
2. 检查控制台日志中的诊断信息
3. 查看"显示诊断信息"获取详细分析

### 性能优化
- 大文件（>50MB）建议使用有线网络
- 导入期间避免浏览器切换标签页
- 建议在服务器负载较低时进行导入

## 📝 日志信息

导入过程中会显示：
```
📂 包含 WAL 文件: memos_dev.db-wal
📂 包含 SHM 文件: memos_dev.db-shm
正在上传 3 个数据库文件...
✅ 完整数据库文件组合已准备就绪
```

这表示多文件导入功能正常工作。