# Memos 数据库导入功能测试指南

## 🎯 功能概述

现在 Next.js 版本已经支持真正的 Memos 数据库导入功能！该功能可以导入您提供的数据库文件，包含：
- ✅ **67 条备忘录记录**
- ✅ **8 个图片附件**
- ✅ **标签和时间戳**
- ✅ **置顶状态**

## 🚀 如何测试

### 1. 打开设置界面
1. 点击左侧边栏的用户头像或设置图标
2. 切换到"数据"标签页
3. 找到"从 Memos 数据库导入"区域

### 2. 导入数据库文件
1. **选择文件**：
   - 点击"选择文件"按钮
   - 或直接拖拽文件到虚线框内
   
2. **推荐文件选择**：
   - 主要文件：`memos_dev.db` (7.1MB)
   - 可选文件：`memos_dev.db-wal` (958KB) - 确保数据完整性
   - 可选文件：`memos_dev.db-shm` (32KB) - 确保数据完整性

3. **开始导入**：
   - 选择文件后会出现"开始导入"按钮
   - 点击按钮开始导入过程

### 3. 导入过程
系统会显示以下进度：
1. "正在上传数据库文件..."
2. "正在合并数据到本地存储..."
3. 显示导入成功结果

## 📊 预期结果

导入完成后，您应该看到：
```
✅ 导入成功！
新增 67 条备忘录，包含 8 个图片附件
```

## 🔍 验证导入结果

### 1. 查看备忘录
- 返回主界面查看"近期想法"区域
- 应该能看到新导入的备忘录
- 置顶的备忘录会出现在"置顶备忘录"区域

### 2. 检查图片附件
- 找到包含图片的备忘录
- 图片应该正确显示为内嵌图片
- 图片数据已转换为 base64 格式

### 3. 检查标签
- 导入的备忘录中的 #标签 应该正确解析
- 可以通过标签筛选功能验证

## ⚙️ 技术实现

### 架构方案
- **前端**: `WorkingMemosImport.jsx` - 文件上传和用户界面
- **后端**: `/api/memos-import.js` - 服务器端数据库解析
- **数据库**: 使用 `sqlite3` 在服务器端解析
- **存储**: 合并到浏览器 localStorage

### 数据处理流程
1. **文件上传** → API 路由接收文件
2. **数据库解析** → 服务器端使用 sqlite3 解析
3. **数据转换** → 转换时间戳、提取标签、处理图片
4. **图片嵌入** → 将图片转换为 base64 并嵌入内容
5. **本地合并** → 与现有数据合并，避免重复

### 数据格式转换
```javascript
// Memos 原始格式 → MeowNocode 格式
{
  id: 1,                    → id: "memos-1",
  created_ts: 1640995200,   → createdAt: "2022-01-01T00:00:00.000Z",
  updated_ts: 1640995200,   → updatedAt: "2022-01-01T00:00:00.000Z",
  content: "Hello #world",  → content: "Hello #world",
  pinned: 1,               → (添加到 pinnedMemos 数组)
  // + 图片处理和标签提取
}
```

## 🐛 常见问题

### 1. 导入失败
- **检查文件格式**：确保是 .db 文件
- **检查文件大小**：过大的文件可能需要更多时间
- **查看控制台**：F12 打开开发者工具查看错误信息

### 2. 部分数据缺失
- **选择所有文件**：建议同时选择 .db、.db-wal、.db-shm 文件
- **数据库完整性**：确保数据库文件来自最新的 Memos 备份

### 3. 图片不显示
- **支持格式**：目前支持存储在数据库中的图片 (BLOB)
- **文件大小**：极大的图片可能影响性能

## 📝 测试清单

- [ ] 能够正常选择数据库文件
- [ ] 拖拽文件功能正常
- [ ] 导入进度正确显示
- [ ] 导入成功提示出现
- [ ] 备忘录数量正确 (67条)
- [ ] 图片附件正确嵌入 (8个)
- [ ] 置顶状态正确保留
- [ ] 标签正确解析
- [ ] 时间戳正确转换
- [ ] 不会产生重复数据

## 🎉 成功标志

如果您看到以下内容，说明导入功能完全成功：

1. **设置界面**：Memos 导入区域显示完整的文件选择界面
2. **文件处理**：能够选择并显示 .db 文件信息  
3. **导入过程**：显示清晰的进度指示
4. **结果反馈**：显示"导入成功！新增 67 条备忘录，包含 8 个图片附件"
5. **数据展示**：在主界面能看到所有导入的备忘录
6. **功能完整**：图片、标签、置顶状态都正确保留

现在您可以开始测试这个强大的数据导入功能了！🚀