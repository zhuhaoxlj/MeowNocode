# MeowNocode å¤šå­˜å‚¨æ–¹æ¡ˆ

## ğŸ¯ æ¦‚è¿°

åŸºäºåŸç‰ˆ **memos** é¡¹ç›®çš„å¤šé©±åŠ¨æ¶æ„è®¾è®¡ï¼ŒMeowNocode ç°åœ¨æ”¯æŒå¤šç§å­˜å‚¨æ–¹å¼ï¼Œè®©æ‚¨å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©æœ€é€‚åˆçš„æ•°æ®å­˜å‚¨æ–¹æ¡ˆã€‚

### ğŸš€ æ ¸å¿ƒç‰¹æ€§

- **ğŸ”„ æ— ç¼åˆ‡æ¢**: æ”¯æŒåœ¨ä¸åŒå­˜å‚¨æ–¹å¼é—´è‡ªç”±åˆ‡æ¢
- **ğŸ“¦ æ•°æ®è¿ç§»**: è‡ªåŠ¨è¿ç§»ç°æœ‰æ•°æ®åˆ°æ–°çš„å­˜å‚¨æ–¹å¼
- **ğŸ›¡ï¸ å…¼å®¹æ€§**: å®Œå…¨å‘åå…¼å®¹ç°æœ‰åŠŸèƒ½
- **âš™ï¸ é…ç½®ç®¡ç†**: å›¾å½¢åŒ–é…ç½®ç•Œé¢ï¼Œç®€å•æ˜“ç”¨
- **ğŸ”§ æ‰©å±•æ€§**: æ˜“äºæ‰©å±•æ–°çš„å­˜å‚¨é€‚é…å™¨

## ğŸ“Š æ”¯æŒçš„å­˜å‚¨ç±»å‹

### 1. ğŸ’¾ **æœ¬åœ°æ•°æ®åº“æ–‡ä»¶** (é»˜è®¤æ¨è)

**ä¼˜åŠ¿**:
- âœ… æ•°æ®æ–‡ä»¶åŒ–ï¼Œæ˜“äºå¤‡ä»½
- âœ… å…¼å®¹åŸç‰ˆ memos æ•°æ®åº“
- âœ… é«˜æ€§èƒ½ SQLite æ•°æ®åº“
- âœ… æ”¯æŒå¯¼å…¥/å¯¼å‡º .db æ–‡ä»¶
- âœ… ç¦»çº¿å®Œå…¨å¯ç”¨

**é™åˆ¶**:
- âš ï¸ ä»…é™å•è®¾å¤‡è®¿é—®
- âš ï¸ éœ€è¦æ‰‹åŠ¨å¤‡ä»½

**é€‚ç”¨åœºæ™¯**: ä¸ªäººä½¿ç”¨ï¼Œæ³¨é‡æ•°æ®å®‰å…¨å’Œæ€§èƒ½

### 2. ğŸŒ **æµè§ˆå™¨å­˜å‚¨**

**ä¼˜åŠ¿**:
- âœ… æ— éœ€é…ç½®ï¼Œå¼€ç®±å³ç”¨
- âœ… å®Œå…¨ç¦»çº¿å¯ç”¨
- âœ… å“åº”é€Ÿåº¦æœ€å¿«

**é™åˆ¶**:
- âŒ é™åˆ¶äºå•ä¸ªæµè§ˆå™¨
- âŒ å¯èƒ½å› æ¸…ç†ç¼“å­˜ä¸¢å¤±æ•°æ®
- âŒ å­˜å‚¨å®¹é‡æœ‰é™

**é€‚ç”¨åœºæ™¯**: ä¸´æ—¶ä½¿ç”¨ï¼Œå¿«é€Ÿä½“éªŒ

### 3. â˜ï¸ **Cloudflare Workers**

**ä¼˜åŠ¿**:
- âœ… è·¨è®¾å¤‡åŒæ­¥è®¿é—®
- âœ… å…¨çƒ CDN åŠ é€Ÿ
- âœ… é«˜å¯ç”¨æ€§å’Œå¯é æ€§
- âœ… å…è´¹é¢åº¦å……è¶³

**é™åˆ¶**:
- âš ï¸ éœ€è¦ç½‘ç»œè¿æ¥
- âš ï¸ éœ€è¦é…ç½®éƒ¨ç½²

**é€‚ç”¨åœºæ™¯**: å¤šè®¾å¤‡ä½¿ç”¨ï¼Œå›¢é˜Ÿåä½œ

### 4. ğŸª£ **S3 å…¼å®¹å­˜å‚¨** (è®¡åˆ’ä¸­)

**ä¼˜åŠ¿**:
- âœ… ä¼ä¸šçº§å¯é æ€§
- âœ… å‡ ä¹æ— é™å®¹é‡
- âœ… é«˜åº¦å¯å®šåˆ¶

**é™åˆ¶**:
- âš ï¸ é…ç½®ç›¸å¯¹å¤æ‚
- âš ï¸ å¯èƒ½äº§ç”Ÿè´¹ç”¨

**é€‚ç”¨åœºæ™¯**: ä¼ä¸šä½¿ç”¨ï¼Œå¤§è§„æ¨¡æ•°æ®

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```mermaid
graph TB
    subgraph "åº”ç”¨å±‚"
        A[React ç»„ä»¶] --> B[æ–°ç‰ˆæ•°æ®æœåŠ¡]
    end
    
    subgraph "å­˜å‚¨ç®¡ç†å±‚"
        B --> C[å­˜å‚¨ç®¡ç†å™¨]
        C --> D[å­˜å‚¨å·¥å‚]
    end
    
    subgraph "é€‚é…å™¨å±‚"
        D --> E[æœ¬åœ°DBé€‚é…å™¨]
        D --> F[æµè§ˆå™¨å­˜å‚¨é€‚é…å™¨] 
        D --> G[Cloudflareé€‚é…å™¨]
        D --> H[S3é€‚é…å™¨]
    end
    
    subgraph "å­˜å‚¨å±‚"
        E --> I[SQLiteæ–‡ä»¶]
        F --> J[IndexedDB + localStorage]
        G --> K[D1 + R2]
        H --> L[S3å­˜å‚¨]
    end
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

ç¡®ä¿æ‚¨å·²å®‰è£… `sql.js`ï¼š

```bash
npm install sql.js
```

### åŸºæœ¬ä½¿ç”¨

```javascript
import { newDataService } from '@/lib/newDataService.js';

// åˆå§‹åŒ–æ•°æ®æœåŠ¡ï¼ˆè‡ªåŠ¨é€‰æ‹©æœ€ä½³å­˜å‚¨æ–¹å¼ï¼‰
await newDataService.initialize();

// åˆ›å»ºå¤‡å¿˜å½•
const memo = await newDataService.createMemo({
  content: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å¤‡å¿˜å½• #æµ‹è¯•',
  tags: ['æµ‹è¯•'],
  pinned: false
});

// è·å–æ‰€æœ‰å¤‡å¿˜å½•
const memos = await newDataService.getAllMemos();

// è·å–å­˜å‚¨ä¿¡æ¯
const storageInfo = await newDataService.getStorageInfo();
console.log('å½“å‰å­˜å‚¨æ–¹å¼:', storageInfo.adapterType);
```

### åˆ‡æ¢å­˜å‚¨æ–¹å¼

```javascript
import { storageManager } from '@/lib/storage/StorageManager.js';

// åˆ‡æ¢åˆ°æœ¬åœ°æ•°æ®åº“å­˜å‚¨
await storageManager.switchStorageType('localdb', {
  dbPath: 'my-notes.db',
  autoSave: true,
  saveInterval: 30
}, true); // true = è¿ç§»ç°æœ‰æ•°æ®

// åˆ‡æ¢åˆ° Cloudflare å­˜å‚¨
await storageManager.switchStorageType('cloudflare', {
  baseURL: 'https://your-worker.workers.dev'
}, true);
```

## âš™ï¸ é…ç½®é€‰é¡¹

### æœ¬åœ°æ•°æ®åº“é…ç½®

```javascript
{
  dbPath: 'meownocode.db',      // æ•°æ®åº“æ–‡ä»¶å
  autoSave: true,                // è‡ªåŠ¨ä¿å­˜
  saveInterval: 30              // ä¿å­˜é—´éš”(ç§’)
}
```

### Cloudflare é…ç½®

```javascript
{
  baseURL: 'https://your-worker.workers.dev',  // Worker URL
  apiKey: 'optional-api-key'                    // å¯é€‰çš„APIå¯†é’¥
}
```

## ğŸ”§ é«˜çº§ç”¨æ³•

### 1. æ•°æ®å¯¼å…¥å¯¼å‡º

```javascript
// å¯¼å‡ºæ‰€æœ‰æ•°æ®
const exportedData = await newDataService.exportData();

// å¯¼å…¥æ•°æ®
await newDataService.importData(
  exportedData.memos, 
  exportedData.pinnedMemos
);
```

### 2. æœ¬åœ°æ•°æ®åº“æ–‡ä»¶æ“ä½œ

```javascript
// ä»…åœ¨æœ¬åœ°DBæ¨¡å¼ä¸‹å¯ç”¨
if (storageManager.getCurrentStorageType() === 'localdb') {
  // å¯¼å‡ºSQLiteæ–‡ä»¶
  const dbFile = await newDataService.exportDatabaseFile();
  
  // å¯¼å…¥SQLiteæ–‡ä»¶
  const fileInput = document.createElement('input');
  fileInput.type = 'file';
  fileInput.onchange = async (e) => {
    const file = e.target.files[0];
    await newDataService.importDatabaseFile(file);
  };
  fileInput.click();
}
```

### 3. æ‰¹é‡æ“ä½œ

```javascript
const operations = [
  { type: 'create', data: { content: 'å¤‡å¿˜å½•1', tags: [] } },
  { type: 'create', data: { content: 'å¤‡å¿˜å½•2', tags: ['å·¥ä½œ'] } },
  { type: 'update', id: 'memo-123', data: { content: 'æ›´æ–°å†…å®¹' } }
];

const results = await newDataService.batchOperation(operations);
console.log(`${results.filter(r => r.success).length} ä¸ªæ“ä½œæˆåŠŸ`);
```

### 4. å¥åº·æ£€æŸ¥

```javascript
const health = await newDataService.healthCheck();
if (!health.healthy) {
  console.warn('å­˜å‚¨æœåŠ¡å¼‚å¸¸:', health.reason);
}
```

## ğŸ–¥ï¸ UI é›†æˆ

### åœ¨è®¾ç½®ä¸­æ·»åŠ å­˜å‚¨é€‰æ‹©å™¨

```jsx
import StorageSelector from '@/components/StorageSelector';
import { useState } from 'react';

function SettingsPage() {
  const [showStorageSelector, setShowStorageSelector] = useState(false);
  
  return (
    <div>
      <button onClick={() => setShowStorageSelector(true)}>
        å­˜å‚¨è®¾ç½®
      </button>
      
      <StorageSelector
        isOpen={showStorageSelector}
        onClose={() => setShowStorageSelector(false)}
        onStorageChanged={(type, config) => {
          console.log('å­˜å‚¨å·²åˆ‡æ¢:', type, config);
          // åˆ·æ–°ç•Œé¢æ•°æ®
        }}
      />
    </div>
  );
}
```

## ğŸ“¦ æ•°æ®è¿ç§»

### ä»æ—§ç‰ˆæœ¬å‡çº§

å¦‚æœæ‚¨å·²æœ‰ä½¿ç”¨æµè§ˆå™¨å­˜å‚¨çš„æ•°æ®ï¼Œå‡çº§åˆ°æ–°ç‰ˆæœ¬åï¼š

1. **è‡ªåŠ¨æ£€æµ‹**: ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ç°æœ‰æ•°æ®
2. **é€‰æ‹©å­˜å‚¨**: åœ¨è®¾ç½®ä¸­é€‰æ‹©æ–°çš„å­˜å‚¨æ–¹å¼
3. **ä¸€é”®è¿ç§»**: ç‚¹å‡»"ä½¿ç”¨æ­¤å­˜å‚¨"æ—¶ä¼šè‡ªåŠ¨è¿ç§»æ•°æ®
4. **æ•°æ®éªŒè¯**: è¿ç§»åéªŒè¯æ•°æ®å®Œæ•´æ€§

### ä» memos å¯¼å…¥

```javascript
// å¯¼å…¥ memos æ•°æ®åº“æ–‡ä»¶
const memosFile = /* ç”¨æˆ·é€‰æ‹©çš„ .db æ–‡ä»¶ */;

// åˆ‡æ¢åˆ°æœ¬åœ°DBæ¨¡å¼
await storageManager.switchStorageType('localdb');

// å¯¼å…¥æ–‡ä»¶
await newDataService.importDatabaseFile(memosFile);
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: åˆ‡æ¢å­˜å‚¨æ–¹å¼åæ•°æ®ä¸¢å¤±ï¼Ÿ**
A: ç¡®ä¿åœ¨åˆ‡æ¢æ—¶é€‰æ‹©äº†"è¿ç§»æ•°æ®"é€‰é¡¹ã€‚å¦‚æœä»æœ‰é—®é¢˜ï¼Œæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯ã€‚

**Q: æœ¬åœ°æ•°æ®åº“æ¨¡å¼æ— æ³•åˆå§‹åŒ–ï¼Ÿ**
A: ç¡®ä¿æµè§ˆå™¨æ”¯æŒ WebAssembly å’Œ IndexedDBã€‚éƒ¨åˆ†éšç§æ¨¡å¼å¯èƒ½é™åˆ¶è¿™äº›åŠŸèƒ½ã€‚

**Q: Cloudflare å­˜å‚¨è¿æ¥å¤±è´¥ï¼Ÿ**
A: æ£€æŸ¥ Worker URL æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿ Worker å·²æ­£ç¡®éƒ¨ç½²ä¸”å¥åº·æ£€æŸ¥æ¥å£å¯è®¿é—®ã€‚

**Q: æ•°æ®åŒæ­¥é—®é¢˜ï¼Ÿ**
A: æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œç¡®è®¤æ‰€é€‰å­˜å‚¨æ–¹å¼çš„å¥åº·çŠ¶æ€ã€‚

### è°ƒè¯•æ¨¡å¼

```javascript
// å¼€å¯è¯¦ç»†æ—¥å¿—
localStorage.setItem('DEBUG_STORAGE', 'true');

// è·å–å­˜å‚¨ç»Ÿè®¡
const stats = await storageManager.getStorageStats();
console.log('å­˜å‚¨ç»Ÿè®¡:', stats);

// æµ‹è¯•å­˜å‚¨è¿æ¥
const testResult = await storageManager.testStorageType('cloudflare', {
  baseURL: 'https://your-worker.workers.dev'
});
console.log('è¿æ¥æµ‹è¯•:', testResult);
```

## ğŸ”„ ç‰ˆæœ¬å…¼å®¹æ€§

### v1.x -> v2.x å‡çº§

1. **æ•°æ®å¤‡ä»½**: å‡çº§å‰å¯¼å‡ºç°æœ‰æ•°æ®
2. **ä»£ç æ›´æ–°**: æ›´æ–°åˆ°æ–°ç‰ˆæœ¬
3. **æœåŠ¡åˆå§‹åŒ–**: æ–°ç‰ˆä¼šè‡ªåŠ¨åˆå§‹åŒ–å­˜å‚¨ç®¡ç†å™¨
4. **æ•°æ®éªŒè¯**: éªŒè¯æ•°æ®è¿ç§»å®Œæ•´æ€§

### API å˜æ›´

æ–°ç‰ˆæœ¬ä¿æŒäº†å®Œå…¨çš„å‘åå…¼å®¹æ€§ï¼Œæ—§çš„ API è°ƒç”¨ä»ç„¶æœ‰æ•ˆï¼š

```javascript
// æ—§ç‰ˆ APIï¼ˆä»ç„¶æ”¯æŒï¼‰
const memos = JSON.parse(localStorage.getItem('memos') || '[]');

// æ–°ç‰ˆ APIï¼ˆæ¨èï¼‰
const memos = await newDataService.getMemos();
```

## ğŸ“š æ‰©å±•å¼€å‘

### åˆ›å»ºè‡ªå®šä¹‰å­˜å‚¨é€‚é…å™¨

```javascript
import { StorageAdapter } from '@/lib/storage/StorageAdapter.js';

class MyCustomAdapter extends StorageAdapter {
  async initialize() {
    // åˆå§‹åŒ–é€»è¾‘
  }
  
  async createMemo(memoData) {
    // åˆ›å»ºå¤‡å¿˜å½•é€»è¾‘
  }
  
  // å®ç°å…¶ä»–å¿…éœ€æ–¹æ³•...
}

// æ³¨å†Œåˆ°å·¥å‚
import { storageFactory } from '@/lib/storage/StorageFactory.js';
// æ·»åŠ åˆ°æ”¯æŒçš„å­˜å‚¨ç±»å‹é…ç½®...
```

### æ·»åŠ æ–°çš„é…ç½®å­—æ®µ

åœ¨ `StorageFactory.js` ä¸­çš„ `STORAGE_TYPE_CONFIGS` æ·»åŠ æ–°é…ç½®ï¼š

```javascript
[STORAGE_TYPES.CUSTOM]: {
  name: 'è‡ªå®šä¹‰å­˜å‚¨',
  description: 'æˆ‘çš„è‡ªå®šä¹‰å­˜å‚¨æ–¹æ¡ˆ',
  icon: 'ğŸ¯',
  configFields: [
    { key: 'endpoint', label: 'ç«¯ç‚¹åœ°å€', type: 'text', required: true },
    { key: 'timeout', label: 'è¶…æ—¶æ—¶é—´', type: 'number', default: 5000 }
  ]
}
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### æœ€ä½³å®è·µ

1. **é€‰æ‹©åˆé€‚çš„å­˜å‚¨æ–¹å¼**
   - ä¸ªäººä½¿ç”¨ï¼šæœ¬åœ°æ•°æ®åº“
   - å¤šè®¾å¤‡åŒæ­¥ï¼šCloudflare
   - ä¸´æ—¶æµ‹è¯•ï¼šæµè§ˆå™¨å­˜å‚¨

2. **æ•°æ®ç®¡ç†**
   - å®šæœŸå¤‡ä»½é‡è¦æ•°æ®
   - æ¸…ç†ä¸éœ€è¦çš„é™„ä»¶
   - ä½¿ç”¨æ ‡ç­¾ç»„ç»‡æ•°æ®

3. **æ€§èƒ½ä¼˜åŒ–**
   - å¯ç”¨è‡ªåŠ¨ä¿å­˜ï¼ˆæœ¬åœ°DBï¼‰
   - åˆç†è®¾ç½®ä¿å­˜é—´éš”
   - ä½¿ç”¨æ‰¹é‡æ“ä½œå¤„ç†å¤§é‡æ•°æ®

---

**ğŸ’¡ æç¤º**: è¿™ä¸ªå¤šå­˜å‚¨æ–¹æ¡ˆå‚è€ƒäº†ä¼ä¸šçº§ memos é¡¹ç›®çš„æ¶æ„è®¾è®¡ï¼Œä¸ºæ‚¨æä¾›äº†ç”Ÿäº§çº§çš„å¯æ‰©å±•è§£å†³æ–¹æ¡ˆï¼ŒåŒæ—¶ä¿æŒäº†ä½¿ç”¨çš„ç®€å•æ€§ã€‚